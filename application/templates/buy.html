{% extends "layout.html" %} {% block title %} Buy {% endblock %} {% block main
%}

<div>
    <span>Buy a stock from the <a href="https://www.advfn.com/nasdaq/nasdaq.asp" target="_blank">NASDAQ index</a>. Like
        TSLA, NFLX, GOOG, DDD, STX, CCC, SBUX, FOSL... To mention a few. </span><br><br>
    <form action="" method="post">
        {{ form.hidden_tag() }}
        <! –– search bar ––>
            <div class="input-group">
                {% if form.search.errors %}
                {{ form.search(class="form-control is-invalid", autocomplete="off", autofocus=true) }}
                <div class="input-group-append">
                    <! -- search button -->
                        {{ form.search_button(class="mybtn btn btn-outline-secondary fa-text", style="border-radius: 0.25rem;", type="submit", value="&#xf002;"|safe) }}
                </div>
                <div class="invalid-feedback" style="text-align: left;">
                    {% for error in form.search.errors %}
                    <span>{{ error }}</span>
                    {% endfor %}
                </div>
                {% else %}
                {{ form.search(class="form-control", autocomplete="off", autofocus=true) }}
                <div class="input-group-append">
                    <! -- search button -->
                        {{ form.search_button(class="mybtn btn btn-outline-secondary fa-text", autocomplete="off", type="submit", value="&#xf002;"|safe, style="border-radius: 0.25rem;") }}
                </div>
                {% endif %}
            </div>
            <! -- end of searchbar -->

                <! -- product containter, only shows if there's a valid stock in flask session -->
                    {% if ("buystock" not in session) %}
                    <!-- User still hasn't posted anything. -->
                    {% elif "symbol" in session["buystock"] %}
                    <!-- User has searched for a valid stock. -->
                    {% set buyDict = session["buystock"] %}
                    <!-- buyDict is the dictionary with stock information. -->
                    <div class="container-fluid product-container">
                        <!-- PRODUCT -->
                        <div class="container-fluid">
                            <div class="row">
                                <div class="col-12 col-sm-6" style="padding-right: 0; padding-left: 0;">
                                    <h4 class="product-name">
                                        <strong>{{ buyDict["name"] }}</strong>
                                    </h4>
                                    <h4>
                                        <small>{{ buyDict["symbol"] }}</small>
                                    </h4>
                                </div>
                                <div class="col-12 col-sm-6 text-right" style="
              margin-top: auto;
              padding-right: 0;
              padding-left: 0;
              padding-top: 10px;
            ">
                                    <div style="
                display: flex;
                justify-content: flex-end;
                align-items: center;
              ">
                                        <!--Price to the left of input field-->
                                        <span>
                                            <strong>{{"$%.2f"|format(buyDict["price"]) }}
                                                <span class="text-muted" style="padding-right: 4px;">x</span></strong>
                                        </span>
                                        {% if form.shares.errors %}
                                        <div class="input-group float-right" style="max-width: 100px;">
                                            {{ form.shares(class="form-control is-invalid", autocomplete="off", autofocus=true, value=session['buystock']['amount'], size="4") }}
                                            <div class="input-group-append">
                                                <!-- refresh button -->
                                                {{ form.shares_button(class="mybtn btn btn-outline-secondary fa-text", value="&#xf2f1;"|safe, style="border-radius: 0.25rem;") }}
                                            </div>
                                        </div>
                                        {% else %}
                                        <!--Number input field for refresh button-->
                                        <div class="input-group float-right" style="max-width: 100px;">
                                            {{ form.shares(class="form-control", autocomplete="off", autofocus=true, value=session['buystock']['amount'], size="4") }}
                                            <div class="input-group-append">
                                                <!-- refresh button -->
                                                {{ form.shares_button(class="mybtn btn btn-outline-secondary fa-text", value="&#xf2f1;"|safe, style="border-radius: 0.25rem;") }}
                                            </div>
                                        </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            {% if form.shares.errors %}
                            <div class="feedback"
                                style="text-align: right; margin-right: -12px; color: #dc3545; font-size: 80%;">

                                <span>{{ form.shares.errors[0] }}</span>

                            </div>
                            {% endif %}
                        </div>
                        <hr />
                        <!-- END PRODUCT -->
                    </div>
                    <div class="card-footer">
                        <div class="pull-right" style="margin: 10px;">
                            <! -- buy button -->
                                {{ form.submit_button(class="mybtn btn btn-primary") }}
                                <div class="pull-right" style="margin: 5px;">
                                    Total price:
                                    <b>
                                        {% if "buytotal" in buyDict %} {{
            "$%.2f"|format(buyDict["buytotal"]) }} {% endif %}
                                    </b>
                                </div>
                        </div>
                    </div>

                    {% endif %}
    </form>
</div>


{% endblock %}